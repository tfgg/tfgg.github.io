<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tim Green</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

    <link href='/fonts/droid_serif.css' rel='stylesheet' type='text/css'>
    <link href='/fonts/droid_sans.css' rel='stylesheet' type='text/css'>
    <link href='/fonts/roboto_slab.css' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/css/magres.css" />
    <link rel="stylesheet" href="/css/syntax.css" />

    <link rel="shortcut icon" type="image/png" href="/images/my_face.jpg"/>

    <script type='text/javascript' src='/js/jquery-2.1.4.min.js'></script>
    <script type='text/javascript' src='/js/d3.v3.min.js'></script>
    <script type='text/javascript' src='/js/charts.js'/></script>
  </head>
  <body>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-593R7L"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-593R7L');</script>
<!-- End Google Tag Manager -->

    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script>

<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="top-bar"><div class="inner">
  <a href='/'>Tim Green</a> / MagresPython
</div></div>

<div class="magres_heder"><div class="container">
<div class="col-md-6 col-md-offset-3 inner">
<!--<a href='/magres-python/install/' class='btn btn-default'>install</a>-->
<h1>The MagresPython library</h1>
</div>
</div></div>

<div class="container">
  <div class="row">
    <div class="col-md-3 sidebar">
        <!--<h3>Documentation</h3>-->
        <ul>
          <li><a class='link' href='/magres-python/'>Introduction</a></li>
          <li><a class='link' href='/magres-python/install/'>Installation</a></li> 
          <li><a class='link' href='/magres-python/scripts/'>Scripts</a></li>
          <li class='group'>Tutorials
            <ul>
              <!--<li><a class='link' href='/magres-python/tutorials/introduction/'>Introduction</a></li>-->
              <!--<li><a class='link' href='/magres-python/tutorials/atoms/'>Atoms</a></li>-->
              <li><a class='link' href='/magres-python/tutorials/structural/'>Distances and angles</a></li>
              <!--<li><a class='link' href='/magres-python/tutorials/bonding/'>Bonding</a></li>
              <li><a class='link' href='/magres-python/tutorials/cs/'>Chemical shifts</a></li>
              <li><a class='link' href='/magres-python/tutorials/efg/'>Electric field gradients</a></li>
              <li><a class='link' href='/magres-python/tutorials/jc/'>J-coupling</a></li>-->
              <li><a class='link' href='/magres-python/tutorials/disordered/'>Disordered systems</a></li>
            </ul>
          </li>
          <li><a class='external' href='https://github.com/tfgg/magres-format'>Available on Github</a></li>
        </ul>
      </div>
      <div class="col-md-6 content">
      <h1 id="processing-disordered-efgs-in-gehlenite">Processing disordered EFGs in Gehlenite</h1>

<p>Crystallographic techniques such as X-ray diffraction (XRD) often only provide
us with an average topology of a material. However, materials can be disordered,
with spatial deviations from the average structure such as disordered chemical
occupancy of sites, disorded atomic positions and temporal deviations in the
form of dynamics. Solid-state NMR can be an effective local probe of this
disorder, revealing more local chemical environments than are present in the
average topology [<a href="http://dx.doi.org/10.1039/C3CE40982A">Florian 2013</a>]. These
observed local chemical environments correspond to the range of local electronic
environments within the full disordered structural model.</p>

<p>By using ab-initio predictions of the NMR properties of possible local
environments, we can piece together the NMR spectrum of a disordered material
and quantify the structural model in terms of deviations from average topology.
This could be, for example, in terms of probabilities of site occupancies,
probabilities of correlated bonding of particular sites or correlations of NMR
properties with continuously disordered structural parameters, such as bond
angles and strain parameters.</p>

<p>Gehlenite is a disordered aluminosilicate consisting of two types of aluminium
site and one type of silicon site. We want to look at aluminium EFGs to quantify
the amount of disorder in the material, in particular the degree of violation of
the &quot;Loewenstein&quot; rule (avoidance of Al-O-Al linkages) and its structural
effects. This is based on analysis performed in <a href="http://pubs.acs.org/doi/abs/10.1021/cm3016935">Florian
2012</a>.</p>

<p>This tutorial <a href="http://nbviewer.ipython.org/github/tfgg/magres-%0Aformat/blob/master/notebooks/Processing%20disordered%20EFGs.ipynb">is available as an IPython
notebook</a>, which you
can download, modify and run locally.</p>

<p>Load the bits from the <code>magres</code> and other modules that we need:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">magres.utils</span> <span class="kn">import</span> <span class="n">load_all_magres</span>
<span class="kn">from</span> <span class="nn">magres.atoms</span> <span class="kn">import</span> <span class="n">MagresAtoms</span>
</code></pre></div>
<h2 id="randomly-occupied-structures">Randomly occupied structures</h2>

<p>First, let&#39;s load all the structures with random T2 occupation into
<code>orig_structures</code>.</p>

<p>You can download a <code>.zip</code> file with all the structures in <a href="http://tfgg.me/files/tutorials/gehlenite_efgs.zip">from
here</a>, extract this somewhere
and modify the <code>PATH</code> variable to point to the folder where you extracted it.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">PATH</span> <span class="o">=</span> <span class="s">&quot;/home/tim/Downloads/magres-doc/workshop/tutorial_disordered&quot;</span> <span class="c"># modify this</span>

<span class="n">orig_structures</span> <span class="o">=</span> <span class="n">load_all_magres</span><span class="p">(</span><span class="n">PATH</span> <span class="o">+</span> <span class="s">&#39;/files/orig&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;We have {} structures&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orig_structures</span><span class="p">))</span>
</code></pre></div>
<div class='stream'>
<pre>We have 24 structures
</pre>
</div>

<p>Let&#39;s have a look at the data. The following code will plot a histogram of the
aluminium $C_Q$s in all the structures.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">all_Cqs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">orig_structures</span><span class="p">:</span>
    <span class="n">all_Cqs</span> <span class="o">+=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">species</span><span class="p">(</span><span class="s">&#39;Al&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">efg</span><span class="o">.</span><span class="n">Cq</span>
<span class="n">hist</span><span class="p">(</span><span class="n">all_Cqs</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img src="/images/tutorials/magres-tutorial-disordered_9_0.png" alt="png"></p>

<p>Let&#39;s bin our $C_Q$s by what type of aluminium site they&#39;re sitting on. Below is
an image of a layer of the gehlenite structure.</p>

<p><img src="/images/tutorials/magres-tutorial-disordered_11_0.png" width="100%"/></p>

<p>We have (b) T1 and (c) T2 aluminium sites. T1 sites have four Al/Si neighbours
and T2 sites have three Al/Si neighbours. The number of silicon neighbours
varies. T1 sites have between 0 and 4 silicon neighbours and T2 sites have 0 or
1 silicon neighbours, as one of those neighbours must be a T1 aluminium site.
With this in mind, we&#39;ll make the following dictionary structure to hold all our
$C_Q$s:</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Al_Cqs1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;T1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[]},</span>
          <span class="s">&#39;T2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[]},}</span>
</code></pre></div>
<p>Next, we&#39;ll loop over all the structures and aluminium atoms within them. We&#39;ll
then count the number of Al/Si neighbours and number of Si neighbours they each
have, classifying their site in the process. We&#39;ll then put the aluminium atom&#39;s
$C_Q$ into the correct bin.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">bin_sites</span><span class="p">(</span><span class="n">structures</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="c"># Loop over all calculations</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">structures</span><span class="p">):</span>
      <span class="k">print</span> <span class="n">i</span><span class="p">,</span>

      <span class="k">for</span> <span class="n">Al_atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="o">.</span><span class="n">species</span><span class="p">(</span><span class="s">&#39;Al&#39;</span><span class="p">):</span>
        <span class="c"># Find all Al and Si neighbours within 3.5 angstroms of this atom</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">species</span><span class="p">([</span><span class="s">&#39;Al&#39;</span><span class="p">,</span> <span class="s">&#39;Si&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">Al_atom</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>

        <span class="c"># Classify the site</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbours</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
          <span class="n">site</span> <span class="o">=</span> <span class="s">&#39;T1&#39;</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">site</span> <span class="o">=</span> <span class="s">&#39;T2&#39;</span>

        <span class="c"># Count the number of Si neighbours</span>
        <span class="n">num_Si</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighbours</span><span class="o">.</span><span class="n">species</span><span class="p">(</span><span class="s">&#39;Si&#39;</span><span class="p">))</span>

        <span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_Si</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Al_atom</span><span class="o">.</span><span class="n">efg</span><span class="o">.</span><span class="n">Cq</span><span class="p">))</span>

<span class="n">Al_Cqs1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;T1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[]},</span>
          <span class="s">&#39;T2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[]},}</span>

<span class="n">bin_sites</span><span class="p">(</span><span class="n">orig_structures</span><span class="p">,</span> <span class="n">Al_Cqs1</span><span class="p">)</span>
</code></pre></div>
<div class='stream'>
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
</pre>
</div>

<p>Let&#39;s calculate the means and standard deviations for each site bin.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">calc_stats</span><span class="p">(</span><span class="n">bins</span><span class="p">):</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;T1&#39;</span><span class="p">:</span> <span class="p">{},</span>
             <span class="s">&#39;T2&#39;</span><span class="p">:</span> <span class="p">{},}</span>

    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">num_si</span> <span class="ow">in</span> <span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&quot;Al</span><span class="si">%s</span><span class="s">, n_si=</span><span class="si">%d</span><span class="s">, Cq=</span><span class="si">%.2f</span><span class="s"> +- </span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">site</span><span class="p">,</span> <span class="n">num_si</span><span class="p">,</span> <span class="n">mean</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_si</span><span class="p">]),</span> <span class="n">std</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_si</span><span class="p">]))</span>

        <span class="n">stats</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_si</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;mean&#39;</span><span class="p">:</span> <span class="n">mean</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_si</span><span class="p">]),</span> <span class="s">&#39;stdev&#39;</span><span class="p">:</span> <span class="n">std</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="n">num_si</span><span class="p">])}</span>


    <span class="k">return</span> <span class="n">stats</span>

<span class="n">orig_stats</span> <span class="o">=</span> <span class="n">calc_stats</span><span class="p">(</span><span class="n">Al_Cqs1</span><span class="p">)</span>
</code></pre></div>
<div class='stream'>
<pre>AlT2, n_si=0, Cq=8.06 +- 1.55
AlT2, n_si=1, Cq=10.70 +- 1.33
AlT1, n_si=0, Cq=2.43 +- 0.84
AlT1, n_si=1, Cq=7.40 +- 1.31
AlT1, n_si=2, Cq=8.73 +- 1.20
AlT1, n_si=3, Cq=8.03 +- 0.96
AlT1, n_si=4, Cq=7.58 +- 0.79
</pre>
</div>

<h2 id="loewenstein-rule-obeying-structures">Loewenstein-rule obeying structures</h2>

<p>We can run the above analysis again against the Loewenstein-rule obeying
structures, in which each T2 pair must be an aluminium and a silicon.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">low_structures</span> <span class="o">=</span> <span class="n">load_all_magres</span><span class="p">(</span><span class="n">PATH</span> <span class="o">+</span> <span class="s">&#39;/files/low&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;We have {} structures&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">low_structures</span><span class="p">))</span>
</code></pre></div>
<div class='stream'>
<pre>We have 25 structures
</pre>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">Al_Cqs2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;T1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[]},</span>
           <span class="s">&#39;T2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">[]},}</span>
</code></pre></div><div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">bin_sites</span><span class="p">(</span><span class="n">low_structures</span><span class="p">,</span> <span class="n">Al_Cqs2</span><span class="p">)</span>
</code></pre></div>
<div class='stream'>
<pre>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24
</pre>
</div>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">low_stats</span> <span class="o">=</span> <span class="n">calc_stats</span><span class="p">(</span><span class="n">Al_Cqs2</span><span class="p">)</span>
</code></pre></div>
<div class='stream'>
<pre>AlT2, n_si=1, Cq=10.63 +- 0.53
AlT1, n_si=0, Cq=1.01 +- 0.23
AlT1, n_si=1, Cq=5.62 +- 0.35
AlT1, n_si=2, Cq=7.26 +- 0.69
AlT1, n_si=3, Cq=7.05 +- 0.34
AlT1, n_si=4, Cq=7.93 +- 0.47
</pre>
</div>

<p>Showing a shift in almost all the $C_Q$s, indicating the effect that T2
Loewenstein-rule violations have on T1 site EFGs.</p>

    </div>
    <div class="col-md-3">
    </div>
  </div>
</div>
<div class="container-fluid">
  <div class="row footer">
    <div class='col-md-6 footer-left'>
      <p><a href='mailto:timothy.green@gmail.com'>timothy.green@gmail.com</a></p>
      <p><a href='http://twitter.com/tfgg2' target="_blank">Twitter @tfgg2</a></p>
      <p><a href='http://github.com/tfgg' target='_blank'>Github tfgg</a></p>
    </div>
    <div class='col-md-6 footer-right'>
      <address>
      Department of Materials<br/>
      University of Oxford<br/>
      Parks Road<br/>
      Oxford OX1 3PH<br/>
      UK
      </address>
    </div>
  </div>
</div>


  </body>
</html>

